# üöÄ –ó–∞–ø—É—Å–∫ –∏ –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ PHASE 3

## ‚úÖ –ß—Ç–æ —É–∂–µ —Å–¥–µ–ª–∞–Ω–æ

1. ‚úÖ **–ó–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω—ã** (optuna, lightgbm, catboost, etc.)
2. ‚úÖ **–°–∫—Ä–∏–ø—Ç –∑–∞–ø—É—â–µ–Ω –≤ —Ñ–æ–Ω–µ**: `scripts\train_ensemble_cross_validation.py`
3. ‚úÖ **–û–∂–∏–¥–∞–µ–º–æ–µ –≤—Ä–µ–º—è**: ~1 —á–∞—Å

---

## üìä –ö–∞–∫ –°–ª–µ–¥–∏—Ç—å –∑–∞ –ü—Ä–æ–≥—Ä–µ—Å—Å–æ–º

### –í–∞—Ä–∏–∞–Ω—Ç 1: –ó–∞–ø—É—Å—Ç–∏—Ç—å –≤ –Ω–æ–≤–æ–º —Ç–µ—Ä–º–∏–Ω–∞–ª–µ (—Ä–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è)

–ï—Å–ª–∏ —Ö–æ—á–µ—à—å –≤–∏–¥–µ—Ç—å live output:

```bash
# –û—Ç–∫—Ä—ã—Ç—å –Ω–æ–≤—ã–π PowerShell/CMD
cd C:\AI\myAssistent
.\.venv\Scripts\activate
python scripts\train_ensemble_cross_validation.py
```

**Output –±—É–¥–µ—Ç –ø–æ–∫–∞–∑—ã–≤–∞—Ç—å:**
```
================================================================================
                    PHASE 3: Cross-Validation + Walk-Forward
================================================================================

Configuration:
  - TimeSeriesSplit: 5 folds
  - Optuna Trials per Model: 30
  - Timeout: 3600s (60 minutes)
  ...

Fold 1/5
  Train: 1277 samples
  Val:   426 samples

[Fold 1] Optimizing XGBoost (30 trials)...
[Fold 1] XGBoost best params: {...}

[Fold 1] Optimizing LightGBM (30 trials)...
...
```

---

### –í–∞—Ä–∏–∞–Ω—Ç 2: –ü—Ä–æ–≤–µ—Ä–∏—Ç—å —Ñ–∞–π–ª—ã –∞—Ä—Ç–µ—Ñ–∞–∫—Ç–æ–≤

```bash
# –ö–∞–∂–¥—ã–µ 5-10 –º–∏–Ω—É—Ç –ø—Ä–æ–≤–µ—Ä—è–π
dir artifacts\ensemble_*_cv_*.pkl
dir artifacts\ensemble_metadata_cv_*.json
```

**–ï—Å–ª–∏ —Ñ–∞–π–ª—ã –ø–æ—è–≤–∏–ª–∏—Å—å** ‚Üí –æ–±—É—á–µ–Ω–∏–µ –∑–∞–≤–µ—Ä—à–µ–Ω–æ!

---

### –í–∞—Ä–∏–∞–Ω—Ç 3: –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –ø—Ä–æ—Ü–µ—Å—Å—ã

```bash
# –ü—Ä–æ–≤–µ—Ä–∏—Ç—å, —á—Ç–æ Python –ø—Ä–æ—Ü–µ—Å—Å –µ—â–µ —Ä–∞–±–æ—Ç–∞–µ—Ç
tasklist | findstr python
```

–ï—Å–ª–∏ –≤–∏–¥–∏—à—å –Ω–µ—Å–∫–æ–ª—å–∫–æ `python.exe` ‚Üí —Å–∫—Ä–∏–ø—Ç —Ä–∞–±–æ—Ç–∞–µ—Ç.

---

## üéØ –ß—Ç–æ –û–∂–∏–¥–∞—Ç—å

### –≠—Ç–∞–ø—ã –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è

| –≠—Ç–∞–ø | –í—Ä–µ–º—è | –û–ø–∏—Å–∞–Ω–∏–µ |
|------|-------|----------|
| **1. Dataset Loading** | 10-30 —Å–µ–∫ | –ó–∞–≥—Ä—É–∑–∫–∞ 2129 rows √ó 84 features |
| **2. Fold 1 (XGB)** | 5-10 –º–∏–Ω | Optuna 30 trials |
| **3. Fold 1 (LGB)** | 5-10 –º–∏–Ω | Optuna 30 trials |
| **4. Fold 1 (CAT)** | 5-10 –º–∏–Ω | Optuna 30 trials |
| **5. Folds 2-5** | 40-50 –º–∏–Ω | –ü–æ–≤—Ç–æ—Ä–µ–Ω–∏–µ –¥–ª—è –æ—Å—Ç–∞–ª—å–Ω—ã—Ö —Ñ–æ–ª–¥–æ–≤ |
| **6. Final Training** | 2-5 –º–∏–Ω | –û–±—É—á–µ–Ω–∏–µ –Ω–∞ –ø–æ–ª–Ω–æ–º train set |
| **7. Evaluation** | 10-30 —Å–µ–∫ | –û—Ü–µ–Ω–∫–∞ –Ω–∞ test set |

**–ò—Ç–æ–≥–æ:** ~55-75 –º–∏–Ω—É—Ç (–≤ —Å—Ä–µ–¥–Ω–µ–º 60 –º–∏–Ω—É—Ç)

---

## üìÅ Output –§–∞–π–ª—ã

–ü–æ—Å–ª–µ –∑–∞–≤–µ—Ä—à–µ–Ω–∏—è –ø–æ—è–≤—è—Ç—Å—è:

```
artifacts/
‚îú‚îÄ‚îÄ ensemble_<model>_cv_20251012_HHMMSS.pkl    # –õ—É—á—à–∞—è –º–æ–¥–µ–ª—å
‚îî‚îÄ‚îÄ ensemble_metadata_cv_20251012_HHMMSS.json  # –ú–µ—Ç—Ä–∏–∫–∏
```

**–ü—Ä–∏–º–µ—Ä metadata:**
```json
{
  "timestamp": "20251012_220530",
  "phase": 3,
  "method": "cross_validation",
  "n_splits": 5,
  "best_model": "xgboost",
  "test_auc": 0.5834,
  "phase2_test_auc": 0.4829,
  "improvement_pct": 20.8,
  "all_results": {
    "xgboost": {"test_auc": 0.5834, "test_accuracy": 0.5612},
    "lightgbm": {"test_auc": 0.5721, "test_accuracy": 0.5534},
    ...
  }
}
```

---

## üéâ –ö—Ä–∏—Ç–µ—Ä–∏–∏ –£—Å–ø–µ—Ö–∞

### ‚úÖ –ú–∏–Ω–∏–º–∞–ª—å–Ω—ã–π —É—Å–ø–µ—Ö
- `test_auc > 0.55` (—É–ª—É—á—à–µ–Ω–∏–µ —Å 0.4829)
- `improvement_pct > 0`

### üéØ –¶–µ–ª–µ–≤–æ–π —É—Å–ø–µ—Ö
- `test_auc > 0.60`
- `improvement_pct > 20%`

### üèÜ –ò–¥–µ–∞–ª—å–Ω—ã–π —É—Å–ø–µ—Ö
- `test_auc > 0.65`
- `improvement_pct > 35%`

---

## üîß –ï—Å–ª–∏ –ß—Ç–æ-—Ç–æ –ü–æ—à–ª–æ –ù–µ –¢–∞–∫

### –û—à–∏–±–∫–∞: "ModuleNotFoundError"

```bash
# –ü–µ—Ä–µ—É—Å—Ç–∞–Ω–æ–≤–∏—Ç—å –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏
.\.venv\Scripts\python.exe -m pip install -r requirements.txt
```

### –°–∫—Ä–∏–ø—Ç –∑–∞–≤–∏—Å

```bash
# –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –ø—Ä–æ—Ü–µ—Å—Å—ã
tasklist | findstr python

# –£–±–∏—Ç—å –ø—Ä–æ—Ü–µ—Å—Å (–µ—Å–ª–∏ –Ω—É–∂–Ω–æ)
taskkill /F /IM python.exe
```

### –ù–µ—Ö–≤–∞—Ç–∫–∞ –ø–∞–º—è—Ç–∏

–ï—Å–ª–∏ –≤–∏–¥–∏—à—å –æ—à–∏–±–∫—É `MemoryError`:

1. –ó–∞–∫—Ä—ã—Ç—å –¥—Ä—É–≥–∏–µ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è
2. –£–º–µ–Ω—å—à–∏—Ç—å `N_TRIALS` –≤ —Å–∫—Ä–∏–ø—Ç–µ (30 ‚Üí 10)
3. –ó–∞–ø—É—Å—Ç–∏—Ç—å –∑–∞–Ω–æ–≤–æ

---

## üìä –°—Ä–∞–≤–Ω–µ–Ω–∏–µ –†–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤

–ü–æ—Å–ª–µ –∑–∞–≤–µ—Ä—à–µ–Ω–∏—è:

```bash
# –ü—Ä–æ—á–∏—Ç–∞—Ç—å –º–µ—Ç—Ä–∏–∫–∏
python -c "import json; print(json.dumps(json.load(open('artifacts/ensemble_metadata_cv_<timestamp>.json')), indent=2))"
```

**–ò–ª–∏ –≤—Ä—É—á–Ω—É—é:**

```json
PHASE 2 (Single Validation):
- Test AUC: 0.4829
- Val AUC: 0.6538 (overfitting!)

PHASE 3 (Cross-Validation):
- Test AUC: ??? (—Ü–µ–ª—å >0.55)
- Val AUC: ??? (–¥–æ–ª–∂–µ–Ω –±—ã—Ç—å –±–ª–∏–∑–æ–∫ –∫ Test)
```

---

## üöÄ –°–ª–µ–¥—É—é—â–∏–µ –®–∞–≥–∏

### –ï—Å–ª–∏ Test AUC >0.55 ‚úÖ

```bash
# 1. Backtest —Å –Ω–æ–≤–æ–π –º–æ–¥–µ–ª—å—é
python scripts/backtest_improved_model.py

# 2. Paper Trading —Å –Ω–æ–≤–æ–π –º–æ–¥–µ–ª—å—é
# (–æ–±–Ω–æ–≤–∏—Ç—å paper_state.json —Å –Ω–æ–≤—ã–º model_path)

# 3. (–û–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ) Threshold optimization
```

### –ï—Å–ª–∏ Test AUC 0.50-0.55 ‚ö†Ô∏è

–ß–∞—Å—Ç–∏—á–Ω—ã–π —É—Å–ø–µ—Ö, –Ω—É–∂–Ω–æ:
- –£–≤–µ–ª–∏—á–∏—Ç—å N_SPLITS (5 ‚Üí 10 folds)
- –ó–∞–≥—Ä—É–∑–∏—Ç—å –±–æ–ª—å—à–µ –∏—Å—Ç–æ—Ä–∏—á–µ—Å–∫–∏—Ö –¥–∞–Ω–Ω—ã—Ö
- Feature engineering (–Ω–æ–≤—ã–µ —Ñ–∏—á–∏)

### –ï—Å–ª–∏ Test AUC <0.50 ‚ùå

–ü—Ä–æ–≤–∞–ª, —Ä–∞—Å—Å–º–æ—Ç—Ä–µ—Ç—å:
- –£–≤–µ–ª–∏—á–µ–Ω–∏–µ –¥–∞—Ç–∞—Å–µ—Ç–∞ (>10,000 samples)
- –î—Ä—É–≥–∏–µ horizon_steps (12h, 24h)
- **RL-–ø–æ–¥—Ö–æ–¥** –≤–º–µ—Å—Ç–æ supervised learning

---

## üí° –ü–æ–ª–µ–∑–Ω—ã–µ –ö–æ–º–∞–Ω–¥—ã

```bash
# –ü—Ä–æ–≤–µ—Ä–∏—Ç—å —Å—Ç–∞—Ç—É—Å
tasklist | findstr python

# –ü—Ä–æ–≤–µ—Ä–∏—Ç—å —Ñ–∞–π–ª—ã
dir artifacts\ensemble_*_cv_*.*

# –£–±–∏—Ç—å –≤—Å–µ Python –ø—Ä–æ—Ü–µ—Å—Å—ã (–æ—Å—Ç–æ—Ä–æ–∂–Ω–æ!)
taskkill /F /IM python.exe

# –ó–∞–ø—É—Å—Ç–∏—Ç—å –∑–∞–Ω–æ–≤–æ (–µ—Å–ª–∏ –Ω—É–∂–Ω–æ)
python scripts\train_ensemble_cross_validation.py
```

---

**–£–¥–∞—á–∏ —Å –æ–±—É—á–µ–Ω–∏–µ–º PHASE 3! üöÄ**

**Estimated completion:** ~60 –º–∏–Ω—É—Ç –æ—Ç –∑–∞–ø—É—Å–∫–∞  
**Current time:** –ü—Ä–æ–≤–µ—Ä—å, –∫–æ–≥–¥–∞ –∑–∞–ø—É—Å—Ç–∏–ª —Å–∫—Ä–∏–ø—Ç

