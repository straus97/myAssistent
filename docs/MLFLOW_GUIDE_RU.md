# 📊 MLflow UI - Русский Гайд

**URL:** http://localhost:5000  
**Что это:** Система отслеживания ML экспериментов

---

## 🎯 ЧТО ТАКОЕ MLFLOW?

**MLflow** - это платформа для управления ML моделями:
- 📈 Отслеживание экспериментов (параметры, метрики)
- 📦 Версионирование моделей
- 📊 Сравнение разных запусков

---

## 🖥️ КАК ПОЛЬЗОВАТЬСЯ

### Главная страница (Experiments)

После открытия http://localhost:5000 увидишь:

```
┌─────────────────────────────────────┐
│ MLflow                              │
├─────────────────────────────────────┤
│ Experiments                         │  ← Вкладка "Эксперименты"
│ Models                              │  ← Вкладка "Модели"
└─────────────────────────────────────┘
```

---

### 1. Experiments (Эксперименты)

**Что показано:**

| Колонка | Описание | Пример |
|---------|----------|--------|
| **Run Name** | Имя запуска модели | `xgboost_20251012_162229` |
| **Created** | Дата обучения | `2025-10-12 16:22:29` |
| **Source** | Откуда запущено | `scripts/train_ensemble_optimized.py` |
| **Parameters** | Гиперпараметры | `max_depth=6, n_estimators=200` |
| **Metrics** | Метрики модели | `roc_auc=0.5129, accuracy=0.5070` |

**Как читать:**

1. **Каждая строка** = один запуск обучения модели
2. **Зеленая звездочка** ⭐ = лучшая модель (по выбранной метрике)
3. **Кликни на Run Name** → увидишь детали

---

### 2. Детали Run (клик по имени)

После клика откроется страница с деталями:

#### Вкладка "Parameters" (Параметры)

```
┌─────────────────────────────┐
│ Parameters                  │
├─────────────────────────────┤
│ n_estimators      200       │  ← Количество деревьев
│ max_depth         6         │  ← Глубина дерева
│ learning_rate     0.05      │  ← Скорость обучения
│ subsample         0.8       │  ← Доля данных для обучения
│ n_features        84        │  ← Количество фичей
└─────────────────────────────┘
```

**Что это:** Настройки, с которыми обучалась модель.

---

#### Вкладка "Metrics" (Метрики)

```
┌─────────────────────────────┐
│ Metrics                     │
├─────────────────────────────┤
│ roc_auc          0.5129     │  ← Качество модели (0-1)
│ accuracy         0.5070     │  ← Точность (0-1)
│ threshold        0.5        │  ← Порог решения
│ total_return     0.032      │  ← Доходность (%)
│ sharpe_like      0.45       │  ← Sharpe Ratio
└─────────────────────────────┘
```

**Что это:**
- `roc_auc` - качество модели (выше = лучше, >0.5 = работает)
- `accuracy` - процент правильных предсказаний
- `total_return` - доходность на бэктесте
- `sharpe_like` - риск-adjusted return (>1.0 = хорошо)

---

#### Вкладка "Artifacts" (Файлы)

```
┌─────────────────────────────┐
│ Artifacts                   │
├─────────────────────────────┤
│ 📁 model/                   │  ← Сохраненная модель
│ 📄 features.json            │  ← Список фичей (84 шт)
│ 📄 metrics.json             │  ← Метрики (детали)
│ 📊 feature_importance.png   │  ← График важности фичей
└─────────────────────────────┘
```

**Кликни на файл** → скачать или посмотреть.

---

### 3. Models (Реестр моделей)

**Переключись на вкладку "Models":**

```
┌─────────────────────────────────────┐
│ Models                              │
├─────────────────────────────────────┤
│ xgboost_trading_model               │  ← Название модели
│   ├─ Version 1 [Production]         │  ← В продакшне
│   ├─ Version 2 [Staging]            │  ← На тестировании
│   └─ Version 3 [None]               │  ← Архив
└─────────────────────────────────────┘
```

**Стадии:**
- **Production** - используется в реальной торговле
- **Staging** - тестируется
- **Archived** - старая версия
- **None** - не назначена

**Как использовать:**

1. Обучил модель → MLflow автоматически создал Version
2. Кликни на Version → "Transition to Stage"
3. Выбери "Production" → модель станет активной

---

## 📊 КАК СРАВНИТЬ МОДЕЛИ

### Способ 1: В таблице Experiments

1. Выбери чекбоксами несколько runs
2. Нажми "Compare" (вверху)
3. Увидишь сравнительную таблицу:

```
┌────────────────────────────────────────────────┐
│ Run Name          │ roc_auc │ accuracy │ return │
├────────────────────────────────────────────────┤
│ run_1 (PHASE 2)  │ 0.4829  │ 0.4789   │ -2.56% │
│ run_2 (PHASE 3)  │ 0.5129  │ 0.5070   │ ???    │
└────────────────────────────────────────────────┘
```

---

### Способ 2: Графики

1. Выбери метрику (например, `roc_auc`)
2. Нажми "Chart" (вверху)
3. Выбери тип графика:
   - **Parallel Coordinates** - сравнение параметров
   - **Scatter Plot** - корреляция метрик
   - **Contour Plot** - зависимость от 2 параметров

---

## 🔍 ВАЖНЫЕ МЕТРИКИ

### ROC AUC (0-1)

```
< 0.5   ❌ Хуже случайного (flip a coin)
0.5-0.6 ⚠️ Работает, но плохо
0.6-0.7 ✅ Хорошо
0.7-0.8 ✅ Отлично
> 0.8   🏆 Превосходно (редко для крипты!)
```

**Наши результаты:**
- PHASE 2: 0.4829 ❌
- PHASE 3: 0.5129 ⚠️ (минимальный успех)

---

### Sharpe Ratio

```
< 0     ❌ Убыточно
0-0.5   ⚠️ Очень рискованно
0.5-1.0 ⚠️ Приемлемо
1.0-2.0 ✅ Хорошо
> 2.0   🏆 Отлично
```

**Цель:** >1.0

---

### Total Return (%)

```
< 0%    ❌ Убыток
0-3%    ⚠️ Слабая прибыль
3-10%   ✅ Хорошая прибыль
> 10%   🏆 Отличная прибыль
```

**Цель:** >5%

---

## 💡 ЧАСТЫЕ ВОПРОСЫ

### Почему нет данных?

MLflow логирует только когда:
1. Запущен MLflow server (Docker или start_all.bat)
2. В `.env` есть `MLFLOW_TRACKING_URI=http://localhost:5000`
3. Обучение модели вызвано через API или скрипты

### Как удалить старые runs?

1. Кликни на Run Name
2. Нажми "Delete" (вверху справа)
3. Подтверди

### Где хранятся данные?

```
artifacts/
└── mlruns/
    └── 0/  # Experiment ID
        ├── meta.yaml
        └── <run_id>/  # Каждый запуск
            ├── artifacts/
            ├── metrics/
            └── params/
```

---

## 🚀 ИСПОЛЬЗОВАНИЕ В PRODUCTION

### Получить лучшую модель из Production

```python
POST /mlflow/models/xgboost_trading_model/stage/Production

Response:
{
  "model_path": "artifacts/models/xgboost_production_v5.pkl",
  "version": 5,
  "stage": "Production",
  "metrics": {
    "roc_auc": 0.5129,
    "sharpe_ratio": 1.2
  }
}
```

### Перевести модель в Production

```python
POST /mlflow/models/promote
{
  "model_name": "xgboost_trading_model",
  "version": 7,
  "stage": "Production",
  "archive_existing": true  # Архивировать старую
}
```

---

## 📚 ДОПОЛНИТЕЛЬНАЯ ИНФОРМАЦИЯ

**Официальная документация:** https://mlflow.org/docs/latest/index.html  
**Наш API:** http://127.0.0.1:8000/docs#/mlflow

---

**Последнее обновление:** 2025-10-12  
**Автор:** MyAssistent Team

