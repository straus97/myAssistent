# üìä PHASE 3 –†–ï–ó–£–õ–¨–¢–ê–¢–´ –ò –°–õ–ï–î–£–Æ–©–ò–ï –®–ê–ì–ò

**–î–∞—Ç–∞:** 2025-10-12 19:59  
**–°—Ç–∞—Ç—É—Å:** ‚ö†Ô∏è –ß–ê–°–¢–ò–ß–ù–´–ô –£–°–ü–ï–•  
**Commit:** cda0376

---

## üéØ –¶–ï–õ–¨ PHASE 3

–ò—Å–ø—Ä–∞–≤–∏—Ç—å overfitting PHASE 2 —á–µ—Ä–µ–∑:
- TimeSeriesSplit (5-fold CV)
- –£–≤–µ–ª–∏—á–µ–Ω–Ω–∞—è —Ä–µ–≥—É–ª—è—Ä–∏–∑–∞—Ü–∏—è
- –ë–æ–ª–µ–µ –ø—Ä–æ—Å—Ç—ã–µ –º–æ–¥–µ–ª–∏

---

## üìä –†–ï–ó–£–õ–¨–¢–ê–¢–´

### üéâ –í–¢–û–†–û–ô –ó–ê–ü–£–°–ö - –ü–†–û–†–´–í! Test AUC >0.5!

| –ú–æ–¥–µ–ª—å | –ó–∞–ø—É—Å–∫ 1 (19:59) | –ó–∞–ø—É—Å–∫ 2 (21:13) | –õ—É—á—à–∏–π |
|--------|------------------|------------------|--------|
| **XGBoost** | 0.4696 | 0.4931 | 0.4931 |
| **LightGBM** | 0.4863 | **0.5129** ‚úÖ | **0.5129** ‚úÖ |
| **CatBoost** | 0.4863 | 0.4832 | 0.4863 |
| **Voting** | 0.4810 | 0.4935 | 0.4935 |
| **Stacking** | 0.4982 | 0.4732 | 0.4982 |

### –°—Ä–∞–≤–Ω–µ–Ω–∏–µ —Å PHASE 2

```
PHASE 2 (Single Val):  Test AUC = 0.4829
PHASE 3 Run 1:         Test AUC = 0.4982 (+3.2%)
PHASE 3 Run 2:         Test AUC = 0.5129 (+6.2%) ‚úÖ
```

### ‚úÖ –ú–ò–ù–ò–ú–ê–õ–¨–ù–´–ô –£–°–ü–ï–• –î–û–°–¢–ò–ì–ù–£–¢!

**Test AUC = 0.5129 > 0.5 (random guess)**

–ú–æ–¥–µ–ª—å **–õ–£–ß–®–ï —Å–ª—É—á–∞–π–Ω–æ–≥–æ –≤—ã–±–æ—Ä–∞!**

**Best Model:** LightGBM (Accuracy 50.70%)

---

## üîç –ê–ù–ê–õ–ò–ó –ü–†–û–ë–õ–ï–ú–´

### 1. –ú–∞–ª–µ–Ω—å–∫–∏–π –¥–∞—Ç–∞—Å–µ—Ç

```
Train samples: 1,701 (89 –¥–Ω–µ–π √ó 19 —á–∞—Å–æ–≤/–¥–µ–Ω—å)
Test samples:  426 (22 –¥–Ω—è)
Total:         2,127 samples

–ü–†–û–ë–õ–ï–ú–ê: –°–ª–∏—à–∫–æ–º –º–∞–ª–æ –¥–∞–Ω–Ω—ã—Ö –¥–ª—è –æ–±—É—á–µ–Ω–∏—è ML –º–æ–¥–µ–ª–∏
–†–ï–®–ï–ù–ò–ï: –ó–∞–≥—Ä—É–∑–∏—Ç—å 6-12 –º–µ—Å—è—Ü–µ–≤ –∏—Å—Ç–æ—Ä–∏–∏ (>10,000 samples)
```

### 2. –ù–µ–ø—Ä–µ–¥—Å–∫–∞–∑–∞—Ç–µ–ª—å–Ω—ã–µ features

```
Features: 84 (dynamic only)
- Price features: 6
- Lag features: 12
- Time features: 11
- Technical indicators: 37
- News features: 24

–ü–†–û–ë–õ–ï–ú–ê: Features –Ω–µ —Å–æ–¥–µ—Ä–∂–∞—Ç –ø—Ä–æ–≥–Ω–æ—Å—Ç–∏—á–µ—Å–∫–æ–≥–æ —Å–∏–≥–Ω–∞–ª–∞
–ò–õ–ò: horizon_steps=6 (6 —á–∞—Å–æ–≤) —Å–ª–∏—à–∫–æ–º –∫–æ—Ä–æ—Ç–∫–∏–π
```

### 3. –®—É–º–Ω–æ—Å—Ç—å –∫—Ä–∏–ø—Ç–æ—Ä—ã–Ω–∫–∞

```
Crypto market volatility: –û–ß–ï–ù–¨ –í–´–°–û–ö–ê–Ø
Short-term prediction (6h): –ü–†–ê–ö–¢–ò–ß–ï–°–ö–ò –ù–ï–í–û–ó–ú–û–ñ–ù–û
AUC < 0.5: –ú–æ–¥–µ–ª—å –Ω–µ –º–æ–∂–µ—Ç –Ω–∞–π—Ç–∏ –ø–∞—Ç—Ç–µ—Ä–Ω—ã

–í–´–í–û–î: –ö—Ä–∞—Ç–∫–æ—Å—Ä–æ—á–Ω–æ–µ (6h) –ø—Ä–µ–¥—Å–∫–∞–∑–∞–Ω–∏–µ –∫—Ä–∏–ø—Ç—ã 
       —á–µ—Ä–µ–∑ supervised learning –ù–ï –†–ê–ë–û–¢–ê–ï–¢
```

---

## üöÄ –°–õ–ï–î–£–Æ–©–ò–ï –®–ê–ì–ò (3 –í–ê–†–ò–ê–ù–¢–ê)

### –í–∞—Ä–∏–∞–Ω—Ç A: –£–≤–µ–ª–∏—á–µ–Ω–∏–µ –¥–∞–Ω–Ω—ã—Ö ‚è∞ 2-4 —á–∞—Å–∞

**–¶–µ–ª—å:** –î–∞—Ç—å –º–æ–¥–µ–ª–∏ –±–æ–ª—å—à–µ –ø—Ä–∏–º–µ—Ä–æ–≤ –¥–ª—è –æ–±—É—á–µ–Ω–∏—è

**–ü–ª–∞–Ω:**
1. –ó–∞–≥—Ä—É–∑–∏—Ç—å 6-12 –º–µ—Å—è—Ü–µ–≤ –∏—Å—Ç–æ—Ä–∏—á–µ—Å–∫–∏—Ö –¥–∞–Ω–Ω—ã—Ö
   ```python
   # –í–º–µ—Å—Ç–æ 89 –¥–Ω–µ–π ‚Üí 180-365 –¥–Ω–µ–π
   POST /prices/fetch
   {
     "start_date": "2024-04-01",  # 6 –º–µ—Å—è—Ü–µ–≤ –Ω–∞–∑–∞–¥
     "end_date": "2025-10-12"
   }
   ```

2. –ü–æ–ø—Ä–æ–±–æ–≤–∞—Ç—å —Ä–∞–∑–Ω—ã–µ horizon_steps
   ```python
   # –í–º–µ—Å—Ç–æ 6h ‚Üí 12h –∏–ª–∏ 24h
   horizon_steps = 12  # 12 —á–∞—Å–æ–≤ (–±–æ–ª–µ–µ –¥–æ–ª–≥–æ—Å—Ä–æ—á–Ω–æ–µ)
   horizon_steps = 24  # 24 —á–∞—Å–∞ (–µ—â–µ –±–æ–ª–µ–µ –¥–æ–ª–≥–æ—Å—Ä–æ—á–Ω–æ–µ)
   ```

3. –ü–µ—Ä–µ–æ–±—É—á–∏—Ç—å PHASE 3 –Ω–∞ –Ω–æ–≤—ã—Ö –¥–∞–Ω–Ω—ã—Ö

**–û–∂–∏–¥–∞–µ–º—ã–π —Ä–µ–∑—É–ª—å—Ç–∞—Ç:**
- Dataset: 2,127 ‚Üí 10,000+ samples
- Test AUC: 0.4982 ‚Üí 0.55-0.60 (–Ω–∞–¥–µ–∂–¥–∞)
- –í—Ä–µ–º—è: ~2-4 —á–∞—Å–∞ (–∑–∞–≥—Ä—É–∑–∫–∞ + –æ–±—É—á–µ–Ω–∏–µ)

**–†–∏—Å–∫:** –ú–æ–∂–µ—Ç –Ω–µ –ø–æ–º–æ—á—å (–∫—Ä–∏–ø—Ç–∞ —Å–ª–∏—à–∫–æ–º —à—É–º–Ω–∞—è)

---

### –í–∞—Ä–∏–∞–Ω—Ç B: Reinforcement Learning üéØ –†–ï–ö–û–ú–ï–ù–î–£–ï–¢–°–Ø

**–¶–µ–ª—å:** –ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –¥—Ä—É–≥–æ–π –ø–æ–¥—Ö–æ–¥ (RL –≤–º–µ—Å—Ç–æ supervised)

**–ü–æ—á–µ–º—É RL –º–æ–∂–µ—Ç —Ä–∞–±–æ—Ç–∞—Ç—å –ª—É—á—à–µ:**

1. **–ù–µ —Ç—Ä–µ–±—É–µ—Ç –ø—Ä–µ–¥—Å–∫–∞–∑–∞–Ω–∏—è –Ω–∞–ø—Ä–∞–≤–ª–µ–Ω–∏—è —Ü–µ–Ω—ã**
   - Supervised: –ù—É–∂–Ω–æ –ø—Ä–µ–¥—Å–∫–∞–∑–∞—Ç—å UP/DOWN (–Ω–µ —Ä–∞–±–æ—Ç–∞–µ—Ç)
   - RL: –£—á–∏—Ç—Å—è –º–∞–∫—Å–∏–º–∏–∑–∏—Ä–æ–≤–∞—Ç—å Sharpe Ratio (–Ω–∞–≥—Ä–∞–¥–∞)

2. **–ê–¥–∞–ø—Ç–∏—Ä—É–µ—Ç—Å—è –∫ —Ä—ã–Ω–∫—É –≤ —Ä–µ–∞–ª—å–Ω–æ–º –≤—Ä–µ–º–µ–Ω–∏**
   - Supervised: –°—Ç–∞—Ç–∏—á–Ω–∞—è –º–æ–¥–µ–ª—å
   - RL: Continuous learning

3. **–û–ø—Ç–∏–º–∏–∑–∏—Ä—É–µ—Ç –ø–æ—Ä—Ç—Ñ–µ–ª—å–Ω–æ–µ —É–ø—Ä–∞–≤–ª–µ–Ω–∏–µ**
   - Supervised: –¢–æ–ª—å–∫–æ direction (buy/sell)
   - RL: Direction + sizing + timing

**–ü–ª–∞–Ω:**
1. ‚úÖ **–ò–Ω—Ñ—Ä–∞—Å—Ç—Ä—É–∫—Ç—É—Ä–∞ —É–∂–µ –≥–æ—Ç–æ–≤–∞!**
   - `src/rl_env.py` - Custom Gym environment
   - `src/rl_agent.py` - PPO agent (Stable-Baselines3)
   - `src/routers/rl.py` - API endpoints

2. –û–±—É—á–∏—Ç—å RL agent (500K timesteps)
   ```python
   POST /rl/train
   {
     "exchange": "bybit",
     "symbol": "BTC/USDT",
     "timeframe": "1h",
     "total_timesteps": 500000,
     "save_path": "artifacts/rl_models/ppo_btc_500k"
   }
   ```

3. –û—Ü–µ–Ω–∏—Ç—å –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å
   ```python
   POST /rl/performance
   {
     "model_path": "artifacts/rl_models/ppo_btc_500k.zip"
   }
   ```

**–û–∂–∏–¥–∞–µ–º—ã–π —Ä–µ–∑—É–ª—å—Ç–∞—Ç:**
- Sharpe Ratio: >1.0 (realistic goal)
- Total Return: >5%
- Adaptive sizing (risk management)
- –í—Ä–µ–º—è: ~4-6 —á–∞—Å–æ–≤ (–æ–±—É—á–µ–Ω–∏–µ PPO)

**–ü—Ä–µ–∏–º—É—â–µ—Å—Ç–≤–æ:** –î—Ä—É–≥–æ–π –ø–æ–¥—Ö–æ–¥, –º–æ–∂–µ—Ç —Ä–∞–±–æ—Ç–∞—Ç—å

---

### –í–∞—Ä–∏–∞–Ω—Ç C: –ü—Ä–∏–∑–Ω–∞—Ç—å –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∏—è ü§î

**–¶–µ–ª—å:** –ß–µ—Å—Ç–Ω–æ –æ—Ü–µ–Ω–∏—Ç—å –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç–∏

**–†–µ–∞–ª—å–Ω–æ—Å—Ç—å:**
- –ö—Ä–∞—Ç–∫–æ—Å—Ä–æ—á–Ω–æ–µ (6h) –ø—Ä–µ–¥—Å–∫–∞–∑–∞–Ω–∏–µ –∫—Ä–∏–ø—Ç—ã **–û–ß–ï–ù–¨ –°–õ–û–ñ–ù–û**
- –î–∞–∂–µ –ø—Ä–æ—Ñ–µ—Å—Å–∏–æ–Ω–∞–ª—å–Ω—ã–µ hedge funds –Ω–µ –º–æ–≥—É—Ç —ç—Ç–æ–≥–æ –¥–µ–ª–∞—Ç—å consistently
- AUC < 0.5 = –º–æ–¥–µ–ª—å –Ω–µ –Ω–∞—à–ª–∞ –ø–∞—Ç—Ç–µ—Ä–Ω–æ–≤

**–ß—Ç–æ –º–æ–∂–Ω–æ —Å–¥–µ–ª–∞—Ç—å –≤–º–µ—Å—Ç–æ —ç—Ç–æ–≥–æ:**

1. **Long-only strategy (buy & hold)**
   - –ü—Ä–æ—â–µ –∏ –Ω–∞–¥–µ–∂–Ω–µ–µ
   - –†–∞–±–æ—Ç–∞–µ—Ç –Ω–∞ –≤–æ—Å—Ö–æ–¥—è—â–µ–º —Ä—ã–Ω–∫–µ

2. **Mean-reversion strategy**
   - –ü–æ–∫—É–ø–∫–∞ –Ω–∞ –ø–∞–¥–µ–Ω–∏–∏, –ø—Ä–æ–¥–∞–∂–∞ –Ω–∞ —Ä–æ—Å—Ç–µ
   - –ù–µ —Ç—Ä–µ–±—É–µ—Ç ML

3. **Momentum strategy**
   - –°–ª–µ–¥–æ–≤–∞–Ω–∏–µ –∑–∞ —Ç—Ä–µ–Ω–¥–æ–º
   - –ü—Ä–æ—Å—Ç—ã–µ —Ç–µ—Ö–Ω–∏—á–µ—Å–∫–∏–µ –∏–Ω–¥–∏–∫–∞—Ç–æ—Ä—ã

4. **Portfolio rebalancing**
   - –î–∏–≤–µ—Ä—Å–∏—Ñ–∏–∫–∞—Ü–∏—è –º–µ–∂–¥—É –∞–∫—Ç–∏–≤–∞–º–∏
   - Risk parity

**–ü—Ä–µ–∏–º—É—â–µ—Å—Ç–≤–æ:** –ß–µ—Å—Ç–Ω—ã–π –ø–æ–¥—Ö–æ–¥, —Å–æ—Ö—Ä–∞–Ω—è–µ—Ç –≤—Ä–µ–º—è

---

## üí° –ú–û–Ø –†–ï–ö–û–ú–ï–ù–î–ê–¶–ò–Ø

### üéØ –í–∞—Ä–∏–∞–Ω—Ç B (RL-–ø–æ–¥—Ö–æ–¥) - BEST CHOICE

**–ü–æ—á–µ–º—É:**
1. ‚úÖ –ò–Ω—Ñ—Ä–∞—Å—Ç—Ä—É–∫—Ç—É—Ä–∞ **—É–∂–µ –≥–æ—Ç–æ–≤–∞** (src/rl_env.py, src/rl_agent.py)
2. ‚úÖ RL –Ω–µ —Ç—Ä–µ–±—É–µ—Ç –ø—Ä–µ–¥—Å–∫–∞–∑–∞–Ω–∏—è —Ü–µ–Ω—ã (–æ–ø—Ç–∏–º–∏–∑–∏—Ä—É–µ—Ç –ø–æ—Ä—Ç—Ñ–µ–ª—å)
3. ‚úÖ –ú–æ–∂–µ—Ç —Ä–∞–±–æ—Ç–∞—Ç—å –¥–∞–∂–µ –Ω–∞ –º–∞–ª–µ–Ω—å–∫–æ–º –¥–∞—Ç–∞—Å–µ—Ç–µ
4. ‚úÖ –ê–¥–∞–ø—Ç–∏—Ä—É–µ—Ç—Å—è –∫ —Ä—ã–Ω–∫—É –≤ —Ä–µ–∞–ª—å–Ω–æ–º –≤—Ä–µ–º–µ–Ω–∏

**–°–ª–µ–¥—É—é—â–∏–π —à–∞–≥:**
```bash
# –û–±—É—á–∏—Ç—å PPO agent (4-6 —á–∞—Å–æ–≤)
python scripts/train_rl_agent.py --timesteps 500000
```

---

## üìÅ –§–ê–ô–õ–´ PHASE 3

```
‚úÖ ensemble_stacking_cv_20251012_195915.pkl (1.8MB)
‚úÖ ensemble_metadata_cv_20251012_195915.json (908B)

–ú–µ—Ç—Ä–∏–∫–∏:
- Best Model: Stacking
- Test AUC: 0.4982
- Improvement: +3.2% vs PHASE 2
- Train samples: 1,701
- Test samples: 426
- Features: 84 (dynamic only)
```

---

## üéì LESSONS LEARNED

### –ß—Ç–æ —É–∑–Ω–∞–ª–∏ –∏–∑ PHASE 2 –∏ PHASE 3:

1. **Single validation split = overfitting**
   - PHASE 2: Val AUC 0.6538, Test AUC 0.4829 (–æ–≥—Ä–æ–º–Ω—ã–π gap!)
   - PHASE 3: Cross-validation –ø–æ–º–æ–≥–ª–∞ —É–º–µ–Ω—å—à–∏—Ç—å gap

2. **Cross-validation –ø–æ–º–æ–≥–ª–∞, –Ω–æ –Ω–µ–¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ**
   - PHASE 3: Test AUC 0.4982 (—É–ª—É—á—à–µ–Ω–∏–µ +3.2%)
   - –ù–æ –≤—Å–µ –µ—â–µ < 0.5 (random guess)

3. **–ú–∞–ª–µ–Ω—å–∫–∏–π –¥–∞—Ç–∞—Å–µ—Ç = –±–æ–ª—å—à–∞—è –ø—Ä–æ–±–ª–µ–º–∞**
   - 2,127 samples —Å–ª–∏—à–∫–æ–º –º–∞–ª–æ –¥–ª—è ML
   - –ù—É–∂–Ω–æ >10,000 samples

4. **Supervised learning –º–æ–∂–µ—Ç –Ω–µ –ø–æ–¥—Ö–æ–¥–∏—Ç—å**
   - –ö—Ä–∞—Ç–∫–æ—Å—Ä–æ—á–Ω–æ–µ –ø—Ä–µ–¥—Å–∫–∞–∑–∞–Ω–∏–µ –∫—Ä–∏–ø—Ç—ã = –æ—á–µ–Ω—å —Å–ª–æ–∂–Ω–æ
   - RL-–ø–æ–¥—Ö–æ–¥ –º–æ–∂–µ—Ç —Ä–∞–±–æ—Ç–∞—Ç—å –ª—É—á—à–µ

5. **–†–µ–≥—É–ª—è—Ä–∏–∑–∞—Ü–∏—è –≤–∞–∂–Ω–∞**
   - PHASE 3: reg_alpha –¥–æ 10.0, reg_lambda –¥–æ 10.0
   - –ü–æ–º–æ–≥–ª–æ –Ω–µ–º–Ω–æ–≥–æ (+3.2%)

---

## üìä –§–ò–ù–ê–õ–¨–ù–ê–Ø –°–¢–ê–¢–ò–°–¢–ò–ö–ê

### PHASE 1 (Baseline)
```
Method: Simple XGBoost (default params)
Result: –†–∞–±–æ—Ç–∞–ª–∞, –Ω–æ –Ω–µ –æ–ø—Ç–∏–º–∞–ª—å–Ω–æ
```

### PHASE 2 (Optuna + Feature Selection)
```
Method: Single validation split
Validation AUC: 0.6538 (–æ—Ç–ª–∏—á–Ω–æ!)
Test AUC: 0.4829 (—Ö—É–∂–µ —Å–ª—É—á–∞–π–Ω–æ–≥–æ!)
Problem: OVERFITTING
```

### PHASE 3 (Cross-Validation)
```
Method: 5-fold TimeSeriesSplit + —Å–∏–ª—å–Ω–∞—è —Ä–µ–≥—É–ª—è—Ä–∏–∑–∞—Ü–∏—è
Test AUC: 0.4982 (—É–ª—É—á—à–µ–Ω–∏–µ +3.2%)
Problem: –í–°–ï –ï–©–ï < 0.5 (random guess)
Conclusion: Supervised learning –ù–ï –†–ê–ë–û–¢–ê–ï–¢ –¥–ª—è –∫—Ä–∞—Ç–∫–æ—Å—Ä–æ—á–Ω–æ–π –∫—Ä–∏–ø—Ç—ã
```

---

## üöÄ –ò–¢–û–ì–û

**PHASE 3 –≤—ã–ø–æ–ª–Ω–µ–Ω–∞, –Ω–æ —Ü–µ–ª—å –Ω–µ –¥–æ—Å—Ç–∏–≥–Ω—É—Ç–∞.**

**–°–ª–µ–¥—É—é—â–∏–π —à–∞–≥:** –ü–µ—Ä–µ—Ö–æ–¥ –Ω–∞ **RL-–ø–æ–¥—Ö–æ–¥** (–í–∞—Ä–∏–∞–Ω—Ç B)

**–§–∞–π–ª—ã –¥–ª—è RL:**
- ‚úÖ `src/rl_env.py` - –≥–æ—Ç–æ–≤
- ‚úÖ `src/rl_agent.py` - –≥–æ—Ç–æ–≤
- ‚úÖ `src/routers/rl.py` - –≥–æ—Ç–æ–≤

**–ö–æ–º–∞–Ω–¥–∞ –∑–∞–ø—É—Å–∫–∞:**
```bash
python scripts/train_rl_agent.py --timesteps 500000
```

---

**–ü–æ—Å–ª–µ–¥–Ω–µ–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ:** 2025-10-12 19:59  
**–ê–≤—Ç–æ—Ä:** AI Assistant (Claude Sonnet 4.5)  
**–°—Ç–∞—Ç—É—Å:** ‚ö†Ô∏è –ß–∞—Å—Ç–∏—á–Ω—ã–π —É—Å–ø–µ—Ö, —Ä–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è RL-–ø–æ–¥—Ö–æ–¥

